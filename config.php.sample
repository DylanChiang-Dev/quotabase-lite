<?php
/**
 * Quotabase-Lite Configuration Template
 * 配置模板檔案 - 複製為 config.php 並填入實際配置
 *
 * @version v2.0.0
 */

// 防止直接訪問
if (!defined('QUOTABASE_SYSTEM')) {
    define('QUOTABASE_SYSTEM', true);
}

/**
 * ========================================
 * 資料庫配置 (Database Configuration)
 * ========================================
 */

define('DB_HOST', getenv('DB_HOST') ?: 'localhost');           // 資料庫主機
define('DB_NAME', getenv('DB_NAME') ?: 'quotabase_lite');      // 資料庫名
define('DB_USER', getenv('DB_USER') ?: 'your_username');       // 資料庫使用者名稱
define('DB_PASS', getenv('DB_PASS') ?: 'your_password');       // 資料庫密碼
define('DB_CHARSET', 'utf8mb4');          // 字元集

/**
 * ========================================
 * 安全配置 (Security Configuration)
 * ========================================
 */

define('SESSION_TIMEOUT', 3600);          // 會話超時時間（秒，預設1小時）
define('CSRF_TOKEN_NAME', 'csrf_token');  // CSRF token 名稱
define('ENCRYPTION_KEY', 'generate_a_32_character_random_string'); // 加密金鑰

/**
 * ========================================
 * 時區配置 (Timezone Configuration)
 * ========================================
 */

define('DEFAULT_TIMEZONE', getenv('DEFAULT_TIMEZONE') ?: 'Asia/Taipei');    // 預設時區
define('DISPLAY_TIMEZONE', getenv('DISPLAY_TIMEZONE') ?: DEFAULT_TIMEZONE); // 顯示時區

/**
 * ========================================
 * 應用配置 (Application Configuration)
 * ========================================
 */

define('APP_NAME', 'Quotabase-Lite');     // 應用名稱
define('APP_VERSION', '2.0.0');           // 應用版本
define('DEFAULT_ORG_ID', 1);              // 預設組織 ID（MVP 使用 1）

/**
 * 預設分頁數量
 */
define('DEFAULT_PAGE_SIZE', 20);

/**
 * ========================================
 * 錯誤處理 (Error Handling)
 * ========================================
 */

// 生產環境：錯誤資訊不顯示，啟用日誌記錄
$serverName = $_SERVER['SERVER_NAME'] ?? '';
$isCli = php_sapi_name() === 'cli';

if (!$isCli && $serverName !== 'localhost' && !isset($_GET['debug'])) {
    ini_set('display_errors', 0);
    ini_set('log_errors', 1);
    ini_set('error_log', __DIR__ . '/logs/error.log');
} else {
    // 開發環境：顯示錯誤資訊
    ini_set('display_errors', 1);
    error_reporting(E_ALL);
}

// 建立日誌目錄
$logDir = __DIR__ . '/logs';
if (!is_dir($logDir)) {
    @mkdir($logDir, 0755, true);
}

/**
 * ========================================
 * 啟動會話 (Start Session)
 * ========================================
 */

if (session_status() === PHP_SESSION_NONE) {
    // 會話安全配置
    ini_set('session.cookie_httponly', 1);
    ini_set('session.use_only_cookies', 1);
    ini_set('session.cookie_secure', isset($_SERVER['HTTPS']));

    session_start();
}

/**
 * ========================================
 * 自動載入函式庫 (Auto-load Functions)
 * ========================================
 */

require_once __DIR__ . '/helpers/functions.php';

/**
 * ========================================
 * 資料庫連線 (Database Connection)
 * ========================================
 */

try {
    $dsn = "mysql:host=" . DB_HOST . ";dbname=" . DB_NAME . ";charset=" . DB_CHARSET;
    $options = [
        PDO::ATTR_ERRMODE            => PDO::ERRMODE_EXCEPTION,
        PDO::ATTR_DEFAULT_FETCH_MODE => PDO::FETCH_ASSOC,
        PDO::ATTR_EMULATE_PREPARES   => false,
    ];

    $pdo = new PDO($dsn, DB_USER, DB_PASS, $options);
} catch (PDOException $e) {
    // 生產環境不顯示詳細錯誤
    if ($_SERVER['SERVER_NAME'] !== 'localhost') {
        error_log("Database connection failed: " . $e->getMessage());
        die("系統維護中，請稍後再試。");
    } else {
        die("資料庫連線失敗: " . $e->getMessage());
    }
}

/**
 * ========================================
 * 初始化系統設定 (Initialize System Settings)
 * ========================================
 */

require_once __DIR__ . '/helpers/functions.php';
